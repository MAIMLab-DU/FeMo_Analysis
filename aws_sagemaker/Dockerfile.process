# Use a smaller base image
FROM python:3.10-slim-bookworm

# Set the working directory
WORKDIR /code

# Copy only requirements.txt first to leverage Docker's cache
COPY requirements.txt /code/

# Install dependencies with no cache and cleanup after
RUN pip install --no-cache-dir -r requirements.txt && \
    rm -rf /root/.cache/pip

# Add project files
COPY femo/ /code/femo/
COPY setup.py /code/setup.py
COPY README.md /code/README.md

# Install the current project
RUN pip install . && rm -rf /root/.cache/pip /usr/local/lib/python3.10/site-packages/tests /usr/local/share/man

# Use CMD to run the app
CMD ["python3"]
